<Project>
  <!--
    This property instructs the .NET Core SDK to treat this package as the shared framework platform.
    This affects how the SDK will trim references and publish output, determines how the runtimeconfig
    files are generated, and may affect how optimizations are preformed by other tools.

    NB: this is _AspNetCore*App*SharedFxIsEnabled, not _AspNetCore*All*SharedFxIsEnabled
  -->
  <PropertyGroup Condition=" '$(_AspNetCoreAppSharedFxIsEnabled)' == 'true' ">
    <MicrosoftNETPlatformLibrary>Microsoft.AspNetCore.App</MicrosoftNETPlatformLibrary>
  </PropertyGroup>

  <!--
    The platform manifest is used to resolve conflicts between versions of assemblies brought in by packages, and the versions
    of those assemblies supplied by the shared runtime. This platform manifest is used as a guardrail to prevent accidental
    upgrades out of the shared framework. If users want to explicitly opt-out of this guardrail (and rely instead on
    runtime resolution of assemblies), they can set DisableAspNetCoreAppPlatformManifest=true in their project file.
  -->
  <PropertyGroup Condition="'$(DisableAspNetCoreAppPlatformManifest)' == ''">
    <DisableAspNetCoreAppPlatformManifest Condition=" '$(AspNetCoreAppPlatformManifestFilePath)' == '' ">true</DisableAspNetCoreAppPlatformManifest>
    <DisableAspNetCoreAppPlatformManifest Condition=" '$(RuntimeIdentifier)' != '' AND '$(SelfContained)' == 'true' ">true</DisableAspNetCoreAppPlatformManifest>
    <DisableAspNetCoreAppPlatformManifest Condition=" '$(MicrosoftNETPlatformLibrary)' != 'Microsoft.AspNetCore.App' ">true</DisableAspNetCoreAppPlatformManifest>
  </PropertyGroup>

  <ItemGroup Condition=" '$(DisableAspNetCoreAppPlatformManifest)' != 'true' ">
    <PackageConflictPlatformManifests Include="$(AspNetCoreAppPlatformManifestFilePath)" />
  </ItemGroup>

  <Target Name="EnsureTFMCompatibility" BeforeTargets="_CheckForInvalidConfigurationAndPlatform">
    <Error
      Text="This version of Microsoft.AspNetCore.App is only compatible with the netcoreapp2.1 target framework. Please target netcoreapp2.1 or choose a version of Microsoft.AspNetCore.App compatible with $(TargetFramework)."
      Condition="'$(TargetFramework)' != 'netcoreapp2.1'"/>
  </Target>
</Project>
